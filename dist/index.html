<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Pomodoro</title>

		<meta charset='utf-8'>

		<meta name='viewport' content='width=device-width, initial-scale=1.0'>
		<meta name='description' content='Increase your efficiency with the pomodoro time management technique'>

		<link rel='icon' href='images/favicon.ico' type='image/x-icon'>
		<link rel='shortcut icon' href='images/favicon.ico' type='image/x-icon'>

		<style type='text/css'>
		*{box-sizing:border-box;padding:0;margin:0}html,body{width:100%;height:100%;font-family:-apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji;font-weight:700;font-size:16px;background:#d1151e;background:-webkit-gradient(linear, left top, left bottom, from(#d1151e), to(#b5121a));background:linear-gradient(#d1151e, #b5121a)}.container{width:100vw;height:100vh;display:grid;place-items:center}.content{display:block;color:#fff;text-align:center}.page-title{margin-bottom:2.5em}.page-title h1{color:#fffafb;font-size:2.25rem}.page-title h1:before{display:inline-block;content:'🍅';font-size:2.25rem;margin-right:8px}.timer_links{font-size:0.8rem}.timer_links>div{display:block}.timer_links a{display:inline-block;font-size:1.953em;color:#f7b0b4;text-decoration:none;padding-bottom:6px;margin:0 5px 10px}.timer_links a:hover{border-bottom:2px solid #f7b0b4;padding-bottom:4px}.timer_links a.selected{color:#fff;border-bottom:2px solid #fff;padding-bottom:4px}@-webkit-keyframes shake{50%{-webkit-transform:rotate(1deg);transform:rotate(1deg)}100%{-webkit-transform:rotate(-1deg);transform:rotate(-1deg)}}@keyframes shake{50%{-webkit-transform:rotate(1deg);transform:rotate(1deg)}100%{-webkit-transform:rotate(-1deg);transform:rotate(-1deg)}}.timers{font-variant-numeric:tabular-nums;font-size:0.4rem;margin-bottom:0.5em;overflow:hidden}.timers.shaking{-webkit-animation:38ms shake 18;animation:38ms shake 18;-webkit-transform:rotate(-1deg);transform:rotate(-1deg)}.timers>div{display:none;font-size:17.75em;line-height:1}.timers>div.active{display:block}.controls{font-size:0.8rem;margin-bottom:60px}.controls a{display:inline-block;font-size:1.563em;color:#f49499;text-decoration:none}.controls a:hover,.controls a.selected{color:#fff}.timer_button{display:block;margin-bottom:1rem}.timer_button a{background:#0f994d;border-radius:14px;color:#fff;padding:12px 18px 14px}.timer_button a:hover{background:#11a754}.timer_button a.running{background:#ac1119;background:#e88617}.timer_button a.running:hover{background:#e98e25}.reset{display:inline-block;margin:0 15px}footer{font-size:0.9rem}footer a{display:inline-block;font-size:1em;color:#f49499;border-bottom:1px solid #f49499;text-decoration:none;padding-bottom:2px;margin:0 16px 10px}footer a:hover{color:#fff;border-bottom:1px solid #fff}.what-modal{position:fixed;top:0;left:0;width:100%;height:100%;z-index:2000;visibility:hidden;-webkit-backface-visibility:hidden;backface-visibility:hidden}.md-show{visibility:visible}.md-overlay{position:fixed;width:100%;height:100%;visibility:hidden;top:0;left:0;z-index:1000;opacity:0;background:#d1151e;-webkit-transition:all 0.3s;transition:all 0.3s}.md-show ~ .md-overlay{opacity:0.9;visibility:visible}.md-effect .md-content{-webkit-transform:scale(2);transform:scale(2);opacity:0;-webkit-transition:all 0.3s;transition:all 0.3s}.md-show.md-effect .md-content{-webkit-transform:scale(1);transform:scale(1);opacity:1}.md-content{height:100%;position:relative;background:#e9202a;box-shadow:0 1px 10px #a21017;color:#fff;padding:35px}.md-content h1{font-size:2em;margin-bottom:10px}.md-content h2{font-size:1.4em;margin-bottom:10px}.md-content p{font-size:1em;font-weight:400;line-height:1.4;letter-spacing:0.02em;margin-bottom:16px}.md-content p:last-child{margin-bottom:0}.md-content a{color:inherit}.md-content ol{list-style-position:inside;margin-bottom:16px}.md-content li{font-weight:400;font-size:1em;line-height:1.6}.md-content aside{font-size:0.8em}.close-modal{display:block;position:absolute;top:8px;right:18px}.close-modal a{display:block;font-size:2em;line-height:1;text-decoration:none}@media all and (min-width: 590px) and (max-height: 580px){.timer_links>div{display:inline-block}.timer_links{font-size:.75rem;margin-bottom:0}.timers{font-size:0.6rem;margin-bottom:1rem !important}.controls{margin-bottom:1rem}}@media all and (min-width: 600px) and (min-height: 450px){.what-modal{position:fixed;top:50%;left:50%;width:85%;max-width:500px;height:414px;-webkit-transform:translate3d(-50%, -50%, 0);transform:translate3d(-50%, -50%, 0)}.md-content{height:414px;border-radius:8px}}@media all and (min-width: 500px){.timers{font-size:.6rem}.controls{font-size:0.9rem}}@media all and (min-width: 550px){.timer_links>div{display:inline-block}.timers{font-size:.75rem}}@media all and (min-width: 700px){.timer_links{font-size:0.9rem}.timer_links a{margin-left:20px;margin-right:20px}}@media all and (min-width: 1000px) and (min-height: 500px){.timer_links,.controls{font-size:1rem}.timers{font-size:0.9rem;margin-bottom:2rem}}@media all and (min-width: 1400px) and (min-height: 700px){.timers{font-size:1rem}}@media all and (max-height: 400px){.timers{font-size:.4rem}.controls{font-size:0.8rem}}
		</style>
	</head>

	<body>
		<div class='container'>
			<div class='content'>
				<div class='page-title'>
					<h1>Pomodoro</h1>
				</div>

				<div class='timer_links'>
					<div>
						<a rel='focus' class='selected' href='#'>FOCUS</a>
					</div>
					<div>
						<a rel='short_break' href='#'>SHORT BREAK</a>
					</div>
					<div>
						<a rel='long_break' href='#'>LONG BREAK</a>
					</div>
				</div>

				<div class='timers'>
					<div class='focus active' data-time='1500' data-orig='25:00'>25:00</div>
					<div class='short_break' data-time='300' data-orig='5:00'>5:00</div>
					<div class='long_break' data-time='600' data-orig='10:00'>10:00</div>
				</div>

				<div class='controls'>
					<div class='timer_button'>
						<a href='#'>start timer</a>
					</div>
					<div class='reset'>
						<a href='#'>reset</a>
					</div>
				</div>

				<footer>
					<a class='what' href='#'>WHAT IS POMODORO?</a><a class='test-audio' href='#'>TEST AUDIO</a>
				</footer>
			</div>
		</div>

		<div class='what-modal md-effect'>
			<div class='md-content'>
				<h1>What is Pomodoro?</h1>
				<p><a href='http://pomodorotechnique.com/' target='_BLANK'>Pomodoro</a> is a technique used for time management. It's based on the idea that splitting up work with small breaks can reduce mental fatigue and improve overall productivity.</p>

				<h2>The Pomodoro Flow</h2>

				<ol>
					<li>Work on a task for 25 minutes</li>
					<li>Take a short, 5 minute break</li>
					<li>Repeat</li>
				</ol>

				<p>Every 4th time around, take a longer, 10 minute break</p>

				<aside>Audio courtesy of <a href='http://www.orangefreesounds.com/desk-bell-sound/' target='_BLANK'>Andrew</a></aside>

				<div class='close-modal'><a href='#'>&#215;</a></div>
			</div>
		</div>

		<div class='md-overlay'></div>

		<audio>
			<source src='audio/ding.ogg'></source>
			<source src='audio/ding.mp3'></source>
			<source src='audio/ding.wav'></source>
		</audio>

		<script>
		window.addEventListener('DOMContentLoaded', (event) => {
			let activeTimer;
			let timerStarted = false;
			let timerRunning = false;

			const timer_button = document.querySelector('.timer_button > a');
			const timer_links  = document.querySelectorAll('.timer_links a');
			const timers	   = document.querySelectorAll('.timers > div');

			document.querySelectorAll('.what, .test-audio, .close-modal').forEach((element) => {
				element.addEventListener('click', function (e) {
					e.preventDefault();
				});
			});

			timer_links.forEach((timer_link) => {
				timer_link.addEventListener('click', function (e) {
					e.preventDefault();

					resetTimers();

					if (!timerRunning) {
						// reset timers if one is at 0
						timers.forEach((timer) => {
							if (timer.getAttribute('data-time-left') < 1) {
								resetTimers();
							}
						});

						timer_links.forEach((timer) => {
							timer.classList.remove('selected');
						});

						var timers_item = e.target;

						timers_item.classList.add('selected');

						var timer_to_show = document.querySelector('.' + timers_item.getAttribute('rel'));

						timers.forEach((timer) => {
							if (timer === timer_to_show) {
								timer.classList.add('active');
							} else {
								timer.classList.remove('active');
							}
						});
					}
				});
			});

			timer_button.addEventListener('click', function (e) {
				e.preventDefault();

				if (!timerRunning) {
					var timer_span = null;

					timers.forEach((timer) => {
						if (timer.classList.contains('active')) {
							timer_span = timer;
						}
					});

					var duration;

					// use "time-left" if timer hasn't been reset
					if (timer_span.getAttribute('data-time-left') > 0) {
						duration = timer_span.getAttribute('data-time-left');
					} else {
						resetTimers();
						duration = timer_span.getAttribute('data-time') - 1;
					}

					startTimer(duration, timer_span);
				} else {
					pauseTimer();
				}
			});

			document.querySelector('.reset > a').addEventListener('click', function (e) {
				e.preventDefault();
				pauseTimer();
				resetTimers();
			});

			document.querySelectorAll('.what, .md-overlay, .close-modal').forEach((element) => {
				element.addEventListener('click', function () {
					document.querySelector('.what-modal').classList.toggle('md-show');
				});
			});

			document.querySelector('.test-audio').addEventListener('click', function () {
				ding();
			});

			function startTimer(duration, timer_span) {
				var timer = duration, minutes, seconds;

				activeTimer = setInterval(function () {
					minutes = parseInt(timer / 60, 10)
					seconds = parseInt(timer % 60, 10);

					seconds = seconds < 10 ? "0" + seconds : seconds;

					document.title = '' + minutes + ':' + seconds + ' - Pomodoro';
					timer_span.textContent = minutes + ':' + seconds;
					timer_span.setAttribute('data-time-left', timer);

					if (--timer < 0) {
						resetTimers();

						ding();

						document.querySelector('.timer').classList.add('shaking');

						setTimeout(() => {
							document.querySelector('.timer').classList.remove('shaking');
						}, 684); // matches CSS: 38ms per animation cycle * 15 cycles
					}
				}, 1000);

				timerStarted = true;
				timerRunning = true;

				showButton('pause');
			}

			function pauseTimer() {
				window.clearInterval(activeTimer);
				timerRunning = false;

				showButton('start');
			}

			// resets all timers to original positions
			function resetTimers() {
				document.title = 'Pomodoro';

				timers.forEach((timer) => {
					timer.removeAttribute('data-time-left');
					timer.textContent = timer.getAttribute('data-orig');
				});

				window.clearInterval(activeTimer);

				timerStarted = false;
				timerRunning = false;

				showButton('start');
			}

			function showButton(toggleVal) {
				if (toggleVal === 'start') {
					const textStr = (timerStarted) ? 'resume timer' : 'start timer';
					timer_button.classList.remove('running');
					timer_button.textContent = textStr;
				} else if (toggleVal === 'pause') {
					timer_button.classList.add('running');
					timer_button.textContent = ('pause timer');
				}
			}

			function ding() {
				document.querySelectorAll('audio')[0].play();
			}
		});
		</script>

		<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</body>
</html>
